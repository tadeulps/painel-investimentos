<section class="produtos-page" role="main">
  <app-page-header
    title="Produtos de Investimento"
    subtitle="Conheça os produtos disponíveis e encontre o ideal para você"
  >
  </app-page-header>

  <div *ngIf="isLoading" class="loading-container" role="status" aria-live="polite">
    <p>Carregando produtos...</p>
  </div>

  <div *ngIf="!isLoading">
    <!-- Produtos Recomendados -->
    <section class="section-container recommended-section" role="region" aria-labelledby="recommended-heading">
      <div class="section-header">
        <h2 id="recommended-heading">Produtos recomendados para você!</h2>
        <p class="section-description">
          Escolhidos com base no seu perfil de risco
        </p>
      </div>

      <div class="products-grid">
        <mat-card
          *ngFor="let product of recommendedProducts"
          class="product-card recommended"
        >
          <mat-card-content>
            <div class="card-header-custom">
              <h3 class="product-name">{{ product.nome }}</h3>
              <div
                class="risk-icon"
                [class]="'risk-icon-' + getRiskClass(product.risco)"
              >
                <mat-icon aria-hidden="true">{{ getRiskIcon(product.risco) }}</mat-icon>
              </div>
            </div>

            <div class="product-details">
              <div class="detail-item">
                <span class="label">Tipo</span>
                <span class="value"> {{ product.tipo }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Rentabilidade</span>
                <span class="value rentabilidade">
                  <mat-icon class="trending-icon" aria-hidden="true">trending_up</mat-icon>
                  {{ (product.taxaAnual * 100).toFixed(2) }}% a.a.
                </span>
              </div>
              <div class="detail-item">
                <span class="label">Risco</span>
                <mat-chip [class]="'risk-' + getRiskClass(product.risco)">{{
                  product.risco
                }}</mat-chip>
              </div>
            </div>
          </mat-card-content>

          <mat-card-actions>
            <app-caixa-button
              variant="secondary"
              [fullWidth]="true"
              (clicked)="simulateInvestment(product)"
            >
              Simular Investimento
            </app-caixa-button>
          </mat-card-actions>
        </mat-card>
      </div>
    </section>

    <!-- Todos os Produtos -->
    <section class="section-container all-products-section" role="region" aria-labelledby="all-products-heading">
      <div class="section-header">
        <h2 id="all-products-heading">Todos os Produtos</h2>
        <p class="section-description">Explore todas as opções disponíveis</p>
      </div>

      <nav class="filters-bar" aria-label="Filtrar produtos por tipo">
        <app-caixa-button
          *ngFor="let type of productTypes"
          [variant]="selectedType === type ? 'secondary' : 'outlined'"
          (clicked)="filterByType(type)"
        >
          {{ type === "Todos" ? "Todos" : type }}
        </app-caixa-button>
      </nav>

      <div class="products-grid">
        <mat-card *ngFor="let product of filteredProducts" class="product-card">
          <mat-card-content>
            <div class="card-header-custom">
              <h3 class="product-name">{{ product.nome }}</h3>
              <div
                class="risk-icon"
                [class]="'risk-icon-' + getRiskClass(product.risco)"
              >
                <mat-icon aria-hidden="true">{{ getRiskIcon(product.risco) }}</mat-icon>
              </div>
            </div>

            <div class="product-details">
               <div class="detail-item">
                <span class="label">Tipo</span>
                <span class="value"> {{ product.tipo }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Rentabilidade</span>
                <span class="value rentabilidade">
                  <mat-icon class="trending-icon" aria-hidden="true">trending_up</mat-icon>
                  {{ (product.taxaAnual * 100).toFixed(2) }}% a.a.
                </span>
              </div>
              <div class="detail-item">
                <span class="label">Risco</span>
                <mat-chip [class]="'risk-' + getRiskClass(product.risco)">{{
                  product.risco
                }}</mat-chip>
              </div>
            </div>
          </mat-card-content>

          <mat-card-actions>
            <app-caixa-button
              variant="secondary"
              [fullWidth]="true"
              (clicked)="simulateInvestment(product)"
            >
              Simular Investimento
            </app-caixa-button>
          </mat-card-actions>
        </mat-card>
      </div>

      <div *ngIf="filteredProducts.length === 0" class="no-results" role="status">
        <p>Nenhum produto encontrado para este filtro.</p>
      </div>
    </section>
  </div>
</section>
